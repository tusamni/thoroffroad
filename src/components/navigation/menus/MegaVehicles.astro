---
// components
import { Icon } from "astro-icon";
import Container from "@/components/Container";

// content
import { getCollection } from "astro:content";

// get vehicle data
const allVehicles = await getCollection("vehicles");
const allModels = await getCollection("models");
---

<div class="py-10 px-4" x-data={`{ vehiclesMega : false }`} x-on:mouseenter={`vehiclesMega = true`} x-on:mouseover.away={`vehiclesMega = false`} x-on:click={`vehiclesMega = true`} :class={`vehiclesMega ? 'bg-white' : ''`} x-cloak>
    <button class="flex gap-1 lg:gap-2">
        <div class="flex gap-2 text-lg">
            Vehicles
            <Icon name="bi:caret-down" class="h-auto w-3" x-show={`!vehiclesMega`} />
            <Icon name="bi:caret-down-fill" class="h-auto w-3" x-show={`vehiclesMega`} x-cloak />
        </div>
    </button>

    <div x-cloak x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0" x-show="vehiclesMega" class="absolute inset-0 top-[104px] z-30 w-full">
        <div class="w-full bg-gradient-to-tr from-stone-700 via-stone-800 to-stone-800">
            <Container classes="py-8">
                <div class="grid grid-cols-4 gap-2 lg:grid-cols-4 lg:gap-4">
                    {
                        allVehicles.map((v) => (
                            <a href={`/vehicles/${v.slug}`} title={v.data.title} class="relative flex items-center border border-stone-600">
                                <div class="z-10 flex h-full w-full flex-col from-stone-700 to-stone-600 p-4 hover:bg-gradient-to-br">
                                    <div class="text-lg font-medium text-white group-hover:underline">{v.data.title}</div>
                                    <ul class="comma-list line-clamp-1 text-sm font-light text-stone-300">
                                        {allModels.map((m) => {
                                            if (m.slug.includes(v.slug)) {
                                                return <li>{m.data.title}</li>;
                                            }
                                        })}
                                    </ul>
                                </div>
                            </a>
                        ))
                    }
                </div>

                <a href="/vehicles" class="mt-8 flex w-fit justify-center text-lg italic text-stone-300 underline">All Vehicles</a>
            </Container>
        </div>
    </div>
</div>

<style>
    .comma-list {
        @apply list-none p-0;
    }

    .comma-list li {
        @apply inline;
    }

    .comma-list li::after {
        content: ", ";
    }

    .comma-list li:last-child::after {
        content: "";
    }
</style>

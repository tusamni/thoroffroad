---
// content
import { getCollection } from "astro:content";
import { Icon } from "astro-icon";

// get vehicle data
const allMakes = await getCollection("makes");
const allModels = await getCollection("models");
---

<div class="relative" x-data={`{ makesMenu : false }`} x-on:mouseenter={`makesMenu = true`} x-on:mouseover.away={`makesMenu = false`} x-on:click={`makesMenu = true`} x-cloak>
    <a href="/vehicles" class="inline-flex items-center gap-x-2 first:font-semibold leading-6 text-white transition px-4 py-3" x-bind:class={`makesMenu ? 'bg-red-500' : ''`}>
        <span>Vehicles</span>

        <Icon name="Chevron" class="w-4 h-4 transition" x-bind:class={`makesMenu ? 'rotate-180' : ''`} />
    </a>

    <div
        x-cloak
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100 scale-100"
        x-transition:leave="transition ease-in duration-100"
        x-transition:leave-start="opacity-100 scale-100"
        x-transition:leave-end="opacity-0"
        x-show="makesMenu"
        class="w-[40em] absolute top-0 mt-12 z-10 bg-gradient-to-r from-stone-100 via-stone-200 to-stone-300 shadow-lg ring-1 ring-stone-900/5">
        <div class="grid grid-cols-2">
            {
                allMakes.map((m) => (
                    <a href={`/vehicles/${m.slug}`} title={m.data.title} class="flex flex-col gap-x-4 font-semibold leading-6 text-stone-900 hover:bg-white px-6 py-4 transition">
                        {m.data.title}

                        <ul class="comma-list line-clamp-1 text-sm text-stone-500 font-normal">
                            {allModels.map((i) => {
                                if (i.data.make.toLowerCase().includes(m.slug)) {
                                    return <li>{i.data.title}</li>;
                                }
                            })}
                        </ul>
                    </a>
                ))
            }
        </div>
    </div>
</div>

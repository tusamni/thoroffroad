---
// components
import { Picture } from "@astrojs/image/components";
import { getEntryBySlug } from "astro:content";

// functions
import { getPublicPath } from "@/functions/Media";

// config
import { imageConfig } from "@/src/config.mjs";

// props
export interface Props {
    src: string;
    sizes?: string;
}
const { src, sizes = "100vw", ...attrs } = Astro.props as Props;

// load image data from content collection
const image = await getEntryBySlug("images", src);
if (!image) {
    console.log(src);
}

// if dev load basic image defaults
const formats = import.meta.env.MODE === "development" ? ["jpg"] : imageConfig.imageFormats;
const widths = import.meta.env.MODE === "development" ? [1000] : imageConfig.imageSizes;
---

{
    image ? (
        <Picture
            src={image.slug ? getPublicPath(`images/${image.slug}.jpg`) : getPublicPath(`images/${src}.jpg`)}
            alt={image.slug && image.data.title}
            aspectRatio={`${image.data.width}:${image.data.height}`}
            formats={formats}
            sizes={sizes}
            widths={widths}
            {...attrs}
            data-img={getPublicPath(`images/${image.slug}.jpg`)}
            data-alt={image.data.title}
            data-caption={image.data.alt}
            data-height={image.data.height}
            data-width={image.data.width}
        />
    ) : (
        <Picture src={getPublicPath(`images/${src}.jpg`)} aspectRatio="1:1" formats={formats} sizes={sizes} widths={widths} {...attrs} />
    )
}

---
import { Image } from "../../config";
import urlExist from "url-exist";
import imageSize from "probe-image-size";

// props
interface Props {
    src: string;
    alt: string;
    sizes?: string;
}
const { src, alt, sizes = "100vw", ...attrs } = Astro.props;

// functions
import { getMedia } from "../../functions/Image";

const fullPath = `${Image.cloudUrl}/images/${src}`;
const sources = Image.imageSizes.map((w) => {
    return `${fullPath}?width=${w} ${w}w`;
});

const srcset = sources.join(", ");
// const dimensions = await imageSize(fullPath);
if ((await urlExist(fullPath)) == false) {
    console.log(`Error: ${fullPath}`);
}
---

<img
    srcset={srcset}
    src={getMedia(`images/${src}`)}
    sizes={sizes}
    alt={alt}
    {...attrs}
    data-img={getMedia(`images/${src}`)}
    data-caption={alt}
/>

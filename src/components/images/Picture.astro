---
// imports
import { getMedia } from "@/functions/Image";
import { ImageConfig } from "@/config";

import imageSize from "probe-image-size";

// props
interface Props {
    src: string;
    alt: string;
    loading?: string;
    sizes?: string;
}
const { src, alt, sizes = "100vw", loading = "lazy", ...attrs } = Astro.props;

// content
const fullPath = `${ImageConfig.cloudUrl}/images/${src}`;
const sources = ImageConfig.imageSizes.map((w) => {
    return `${fullPath}?width=${w}&quality=${ImageConfig.imageQuality} ${w}w`;
});

const srcset = sources.join(", ");

let dimensions;
if (import.meta.env.PROD) {
    dimensions = await imageSize(fullPath);
} else {
    dimensions = {
        width: 500,
        height: 500,
    };
}
---

<img href={fullPath} src={fullPath} data-thumb={fullPath} data-img={fullPath} data-caption={alt}  data-width={dimensions.width} data-height={dimensions.height} srcset={srcset} loading={loading} sizes={sizes} alt={alt} {...attrs} />

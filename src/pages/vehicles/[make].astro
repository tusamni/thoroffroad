---
import Layout from "../../layouts/Layout.astro";

// components
import Background from "../../components/content/Background.astro";
import BuildSnippet from "../../components/builds/BuildSnippet.astro";
import Button from "../../components/buttons/Button.astro";
import Container from "../../components/Container.astro";
import HeadingBase from "../../components/content/headings/HeadingBase.astro";
import Hover from "../../components/images/Hover.astro";
import Picture from "../../components/images/Picture.astro";
import Section from "../../components/Section.astro";
import Surround from "../../components/content/Surround.astro";

// config
import { Business } from "../../config";

// content
import { getCollection } from "astro:content";

export async function getStaticPaths() {
    const allMakes = await getCollection("makes");
    return allMakes.map((make) => ({
        params: { make: make.slug },
        props: { make },
    }));
}
const { make } = Astro.props;

const allModels = await getCollection("models", ({ data }) => {
    return data.make.toLowerCase().includes(make.slug) && data.draft !== true;
});
const allBuilds = await getCollection("builds", ({ data }) => {
    return data.make.includes(make.data.title);
});
---

<Layout>
    <div class="relative">
        <Picture src={make.data.featured} class="absolute inset-0 w-full h-full object-cover saturate-50" width={2000} height={2000} alt={``} />
        <div class="absolute inset-0 w-full h-full bg-gradient-to-r from-black via-black/80 to-black/50"></div>

        <Section>
            <div class="relative">
                <HeadingBase heading={make.data.title} description={make.data.descriptionLong} />
            </div>
        </Section>
    </div>

    <Background theme="secondary">
        {
            allBuilds.length >= 3 && (
                <Section>
                    <Container>
                        <div class="grid grid-cols-1 gap-12 xl:grid-cols-5">
                            <div class="col-span-2 flex flex-col space-y-8 justify-between">
                                <div class="space-y-6">
                                    <h3 class="text-white">Recent {make.data.title} Builds</h3>
                                    <p class="text-xl leading-8 text-neutral-400">
                                        We love showing off our work. We're proud of it and our customers love the finished product.{" "}
                                        <a href="/contact" title={`Contact ${Business.nameLong}`} class="hover:underline text-neutral-300">
                                            Let's start building your dream {make.data.title}
                                        </a>
                                        !
                                    </p>
                                </div>

                                <Button href={`/builds/${make.slug}`}>See Our {make.data.title} Builds</Button>
                            </div>

                            <div class="col-span-3 grid grid-cols-3 gap-8">{allBuilds.map((b) => <BuildSnippet build={b} sizes="300px" />).slice(0, 3)}</div>
                        </div>
                    </Container>
                </Section>
            )
        }

        <Section>
            <Container classes="grid grid-cols-1 lg:grid-cols-2">
                {
                    allModels.map((m) => (
                        <Surround hover={true} href={`/vehicles/${m.slug}`} title={m.data.title} classes="md:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2 p-6 md:p-12">
                            <div class="flex flex-col gap-6 col-span-2 md:col-span-1 lg:col-span-2 xl:col-span-1">
                                <Hover class="w-full h-full">
                                    <Picture src={m.data.featured} alt={m.data.title} class="w-full h-full md:absolute lg:relative xl:absolute object-cover rounded-t-md sm:rounded-md shadow-xl" sizes="400px" />
                                </Hover>
                            </div>

                            <div class="space-y-4 col-span-2 sm:col-span-1 lg:col-span-2 xl:col-span-1">
                                <div class="text-lg font-semibold tracking-tight text-neutral-900">
                                    <h3>{m.data.title}</h3>
                                </div>

                                <div class="text-neutral-600 text-base tracking-normal">{m.data.description}</div>
                            </div>
                        </Surround>
                    ))
                }
            </Container>
        </Section>
    </Background>
</Layout>

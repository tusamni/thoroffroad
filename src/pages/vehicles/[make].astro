---
import Layout from "@/layouts/Layout";

import { getBuildImage } from "@/functions/Image";

import Container from "@/components/Container";
import Gallery from "@/components/images/Gallery";
import Icon from "@/components/Icon";
import Model from "@/components/content/snippets/Model";
import Picture from "@/components/images/Picture";
import Testimonial from "@/components/content/testimonials/Testimonial";

// content
import { getCollection, getEntry } from "astro:content";
export async function getStaticPaths() {
    const allMakes = await getCollection("makes");
    return allMakes.map((make) => ({
        params: { make: make.id },
        props: { make },
    }));
}
const { make } = Astro.props;

const allModels = await getCollection("models", ({ data }) => {
    return data.make.id === make.id;
});
const makeTestimonial = await getEntry(make.data.testimonial);
---

<Layout title={make.data.seo.title} description={make.data.seo.description}>
    <Picture src={getBuildImage(make.data.images.featured.id, make.data.images.featured.headline)} loading="eager" class="header-image object-[50%,50%]" />

    <div class="-mt-20 section section-bottom">
        <Container padding={true}>
            <div class="grid grid-cols-2 sm:gap-4">
                <!-- black content area -->
                <div class="bg-black col-span-2 lg:col-span-1 text-white px-4 sm:px-8 py-8 space-y-8">
                    <h1>{`We're the ${make.data.title} Experts!`}</h1>
                    <div class="text-base space-y-4" set:html={make.data.description.short} />

                    <!-- cta buttons -->
                    <div class="flex flex-col gap-4 sm:flex-row lg:flex-col xl:flex-row">
                        <a href="/contact" class="button button-primary !w-full">
                            <div class="button-icon">
                                <Icon icon="hero/EnvelopeFill" class="h-2/5 w-auto" />
                            </div>
                            <div class="button-text">Contact Us!</div>
                        </a>

                        <a href={`/builds/${make.data.title.toLowerCase()}`} class="button button-ghost !w-full">
                            <div class="button-icon">
                                <Icon icon="hero/ArrowRightCircleFill" class="h-2/5 w-auto" />
                            </div>
                            <div class="button-text">{make.data.title} Builds</div>
                        </a>
                    </div>
                </div>

                <div class="col-span-2 lg:col-span-1 flex justify-center px-4 py-6 sm:p-6 items-center bg-white">
                    <Testimonial content={makeTestimonial} />
                </div>
            </div>

            <div class="mt-4 grid grid-cols-3 h-[20em]">
                {make.data.images.featured.secondary.map((i) => (
                    <Picture src={getBuildImage(make.data.images.featured.id, i)} loading="eager" class="object-cover w-full h-full" />
                ))}
            </div>
        </Container>
    </div>

    <div class="bg-neutral-50 section">
        <Container>
            <div class="grid md:grid-cols-2 gap-10">
                <div class="flex flex-col justify-between gap-y-6">
                    <div class="space-y-8">
                        <h2>Let THOR Off-Road Build Your Dream {make.data.title}</h2>
                        <div set:html={make.data.description.long} />
                    </div>

                    <div>
                        <a href="/contact" class="button button-ghost button-inverse">
                            <div class="button-text text-sm lg:text-base">Build Your {make.data.title}!</div>
                        </a>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-8">
                    {allModels.map((m) => <Model model={m} />)}
                </div>
            </div>
        </Container>
    </div>

    <Gallery>
        <div class="grid grid-cols-6 md:grid-cols-12">
            <Picture src="shop/2023-02-23/shop-shoot_01.jpg" alt="Modified Ford Super Duty in Dripping Springs, TX" class="aspect-square object-cover w-full h-full col-span-3 object-bottom" sizes="(min-width: 768px) 50vw, 100vw" />
            <Picture src="shop/2023-02-23/shop-shoot_01.jpg" alt="Modified Ford Super Duty in Dripping Springs, TX" class="aspect-square object-cover w-full h-full col-span-3 object-bottom" sizes="(min-width: 768px) 50vw, 100vw" />
            <Picture src="shop/2023-02-23/shop-shoot_01.jpg" alt="Modified Ford Super Duty in Dripping Springs, TX" class="aspect-square object-cover w-full h-full col-span-3 object-bottom" sizes="(min-width: 768px) 50vw, 100vw" />
            <Picture src="shop/2023-02-23/shop-shoot_01.jpg" alt="Modified Ford Super Duty in Dripping Springs, TX" class="aspect-square object-cover w-full h-full col-span-3 object-bottom" sizes="(min-width: 768px) 50vw, 100vw" />
        </div>
    </Gallery>
</Layout>
